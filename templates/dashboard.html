{% extends "layout.html" %}

{% block content %}
<h2>School Fees Dashboard</h2>

<div class="row mt-4">
    <div class="col"><strong>Total Paid (School):</strong> ${{ "%.2f"|format(total_paid) }}</div>
    <div class="col"><strong>Total Balance (School):</strong> ${{ "%.2f"|format(total_balance) }}</div>
    <div class="col"><strong>Total Fees Expected:</strong> ${{ "%.2f"|format(total_fees) }}</div>
</div>

<a href="/logout" class="btn btn-danger mt-3">Logout</a>

<h4 class="mt-5">Add New Student</h4>
<form action="/add" method="POST" class="row g-3">
    <div class="col-md-3">
        <input type="text" name="name" class="form-control" placeholder="Student Name" required>
    </div>
    <div class="col-md-2">
        <input type="text" name="class" class="form-control" placeholder="Class" required>
    </div>
    <div class="col-md-2">
        <input type="number" step="0.01" name="total_fees" class="form-control" placeholder="Total Fees" required>
    </div>
    <div class="col-md-2">
        <input type="number" step="0.01" name="amount_paid" class="form-control" placeholder="Amount Paid" required>
    </div>
    <div class="col-md-2">
        <button class="btn btn-success" type="submit">Add Student</button>
    </div>
</form>

<h4 class="mt-5">Students List</h4>
<table class="table table-striped">
    <thead>
    <tr>
        <th>Name</th>
        <th>Class</th>
        <th>Total Fees</th>
        <th>Paid</th>
        <th>Balance</th>
        <th>Add Payment</th>
    </tr>
    </thead>
    <tbody>
    {% for s in students %}
        <tr>
            <td>{{ s['name'] }}</td>
            <td>{{ s['class'] }}</td>
            <td>${{ "%.2f"|format(s['total_fees']) }}</td>
            <td>${{ "%.2f"|format(s['amount_paid']) }}</td>
            <td>${{ "%.2f"|format(s['total_fees'] - s['amount_paid']) }}</td>
            <td>
                <form action="/update/{{ s['id'] }}" method="POST" class="d-flex">
                    <input type="number" step="0.01" name="payment" class="form-control me-2" required>
                    <button class="btn btn-primary btn-sm">Add</button>
                </form>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<h4>Scan to open app:</h4>
<img src="{{ url_for('qr_code') }}" alt="QR Code" style="width:150px; height:150px;">

{% endblock %}
<a href="{{ url_for('qr_page') }}" target="_blank">
    <button style="padding:10px 15px; background-color:#4CAF50; color:white; border:none; border-radius:5px;">
        Show QR Code
    </button>
</a>
